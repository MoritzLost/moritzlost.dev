---
import { getCollection } from 'astro:content';
import Time from '@components/Time.astro';
import { sortArticlesByDatePrefix } from '@utils/sort-content';

const articles = await getCollection('articles');
const articlesSorted = sortArticlesByDatePrefix(articles);
const articleLinks = await Promise.all(
    articlesSorted.map(async article => {
        const url = `/articles/${article.slug}`;
        const {
            remarkPluginFrontmatter: { publishedDate },
        } = await article.render();
        return { article, url, publishedDate };
    }),
);
---

<nav aria-label="Primary">
    <!-- <h2>Homepage</h2> -->
    <ul class="menu">
        <li aria-current={Astro.url.pathname === '/'}><a href="/">About me</a></li>
        <li class="menu-anchor"><a href="/#projects">Projects</a></li>
        <li class="menu-anchor"><a href="/#articles">Articles</a></li>
    </ul>

    <hr />

    <h2>Articles</h2>
    <ul class="menu">
        {
            articleLinks.map(({ article, url, publishedDate }) => (
                <li aria-current={url === Astro.url.pathname}>
                    <a href={url}>{article.data.title}</a>
                    <br />
                    <span class="published-date">
                        — <Time date={publishedDate} />
                    </span>
                </li>
            ))
        }
    </ul>
</nav>

<style lang="postcss">
    nav {
        background: #37424a;
        padding: 1.5rem;
        color: white;

        --link-color: white;
        --link-hover-color: white;

        & > :global(* + *) {
            margin-top: var(--stack-gap);
        }
    }

    h2 {
        font-size: var(--font-size-xl);
    }

    .menu {
        font-size: var(--font-size-sm);
        --stack-gap: 1rem;
        > :global(* + *) {
            --stack-gap: 1rem;
            margin-top: var(--stack-gap);
        }

        li {
            &[aria-current] > a::after {
                content: " " "👁"
            }
            &.menu-anchor > a::before {
                content: "#" " ";
            }
            .published-date {
                color: #bbb;
            }
        }

        a {
            --link-text-decoration: none;
        }
    }
</style>
